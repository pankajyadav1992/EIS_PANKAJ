


@model EmployeeInformationSystem.Core.Models.LeaveReportsViewModel

@{
    ViewBag.Title = "DurationWiseLeaves";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Styles.Render("~/Content/bootstrap-select")
@Styles.Render("~/Content/gijgo")



@section CustomStyles{
    @Styles.Render("~/Content/datatable")
    <style>
        #overlay {
            position: absolute;
            justify-content: left;
            z-index: 1000;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba(130, 130, 130, 0.5);
        }
    </style>
}

@section LeaveReports{
    show
}

@section DurationWiseLeaves{
    class="active"
}
<header class="page-header bg-success text-white">
    <div class="container-fluid">
        <h2 class="no-margin-bottom"> View Duration Wise Leave Details</h2>
    </div>
</header>
<div id="overlay" style="text-align:center;display:none">
    <img src="~/Content/img/spinner.gif" style="resize:inherit;" />
    <br />
</div>

<section class="forms">

    <div class="container-fluid" style="position:relative">
        <div class="container-fluid">
            <div class="row" id="reportDisplayBlock">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header d-flex align-items-center">
                            <b> Employee Leave Details</b>
                        </div>
                        <div class="card-body">


                            <div class="form-group row">
                                <label class="col-sm-3 form-control-label">From Date</label>
                                <div class="col-sm-5">
                                    @Html.EditorFor(model => model.Fromdate, new { htmlAttributes = new { @class = "form-control", @type = "text", @data_type = "date", autocomplete = "off" } })
                                </div>
                                <div class="form-group row offset-sm-3">
                                    <div classs="col-sm-9" style="display:none;color: red;" id="errorFromDate">Please select from date</div>
                                </div>
                            </div>

                            <div class="form-group row">
                                <label class="col-sm-3 form-control-label">To Date</label>
                                <div class="col-sm-5">
                                    @Html.EditorFor(model => model.ToDate, new { htmlAttributes = new { @class = "form-control", @type = "text", @data_type = "date", autocomplete = "off" } })
                                </div>
                                <div class="form-group row offset-sm-3">
                                    <div classs="col-sm-9" style="display:none;color: red;" id="errorToDate">Please select to date</div>
                                </div>
                            </div>



                            <div class="form-group row">
                                <div class="col-sm-9 offset-sm-3">
                                    <input type="submit" value="Show" class="btn btn-primary" id="ShowLDetailBtn">
                                </div>
                            </div>



                        </div>

                    </div>


                    <div class="card" id="tblCard" style="display:none">
                        <div class="card-header d-flex align-items-center">
                            <b> Employee Leave Details</b>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped table-bordered" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Organisation</th>
                                        <th>Leave</th>
                                        <th>No of Days</th>
                                        <th>From Date</th>
                                        <th>To Date</th>
                                        <th>Purpose</th>
                                    </tr>
                                </thead>
                                <tbody id="ldTable"></tbody>
                            </table>



                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>


</section>
<script src="https://code.jquery.com/jquery-3.5.1.js"
        integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
        crossorigin="anonymous"></script>
@section Scripts{
    @Scripts.Render("~/bundles/bootstrap-select")
    @Scripts.Render("~/bundles/gijgo")
    <script>
    $(document).ready(function () {



        $('select').selectpicker();
                            $('[data-type="date"]').each(function () {
                                $(this).datepicker({
                                    uiLibrary: 'bootstrap',
                                    format: 'dd-mm-yyyy'
                                });
                            });





        $(document).on('click', '#ShowLDetailBtn', function (e) {
           var isValid = true;
           var australianDate = /^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-./])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$|^$/;









           if (!australianDate.test($("#@Html.IdFor(model => model.Fromdate)").val())) {
               $("#errorFromDate").show(); isValid = false;
               console.log($("#@Html.IdFor(model => model.Fromdate)").val());
           } else {
               $("#errorFromDate").hide();
           }

           if (!australianDate.test($("#@Html.IdFor(model => model.ToDate)").val())) {
               console.log($("#@Html.IdFor(model => model.ToDate)").val());
               $("#errorToDate").show(); isValid = false;
           } else {
                $("#errorToDate").hide();
           }
             if ($("#@Html.IdFor(model => model.Fromdate)").val() == "")
             {
                 $("#errorFromDate").show(); isValid = false;
             }
             else
            { $("#errorFromDate").hide(); }

             if ($("#@Html.IdFor(model => model.ToDate)").val() == "")
             {
                 $("#errorToDate").show(); isValid = false;
             }
             else
             { $("#errorToDate").hide(); }


            if (!isValid) {
                e.preventDefault(); //prevent the default action
            } else {
                $('#overlay').fadeIn(); // show spinner
            }

            if ( $("#@Html.IdFor(model => model.Fromdate)").val()!= "" && $("#@Html.IdFor(model => model.ToDate)").val() != "")
             {
                var data = {
                    'orgId':$("#selectOrgByName option:selected").val(),
                    'Fromdate':$("#@Html.IdFor(model => model.Fromdate)").val(),
                    'ToDate':$("#@Html.IdFor(model => model.ToDate)").val()

                }

                 postData("Leave/DurationWiseReport ", data, "showDetails", "DurationWiseReport");
             }

           });
    });




    </script>

    <script>

        var getUrl = window.location
        var aURL = getUrl.protocol + "//" + getUrl.host + "/" + getUrl.pathname.split('/')[1] + "/";




        function postData(api, inputData, aBy, aTyp) {
            $.ajax({
                type: "POST",
                url: aURL + api,
                data: JSON.stringify(inputData),
                dataType: "JSON",
                contentType: "application/json; charset=utf-8",
                success: function (data) {

                    PostDone(data, aBy, aTyp);
                },
                error: function (err) {
                    window.location.href = aURL;
                    //alert("Something went wrong");
                }
            });
        }


        PostDone = function (data, aBy, aTyp) {

            if (aTyp === "DurationWiseReport") {

                if (aBy === "showDetails") {


                    if (data.length > 0) {
                        $('#ldTable').empty();
                        $('#tblCard').css('display', 'block');

                        $.each(data, function (Key, value) {
                            $('#ldTable').append('<tr role="row"><td class="tableRow">' + value.FullName + '</td><td class="tableRow">' + value.Organisation + '</td><td class="tableRow">' + value.Leave + '</td><td class="tableRow">' + value.NoOfDays + '</td><td class="tableRow">' + value.FromDate + '</td><td>' + value.ToDate + '</td><td class="tableRow">' + value.Purpose + '</td></tr>');

                        });
                    }
                    else {
                        $('#ldTable').empty();
                        $('#tblCard').css('display', 'block');
                        $('#ldTable').append('<tr role="row"><td colspan="7" style="text-align:center"> No records found </td></tr>');


                    }
                    $('#overlay').fadeOut();
                }

            }
        }




    </script>
}
